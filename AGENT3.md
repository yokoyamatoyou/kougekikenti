### **プロジェクト名：オールインワン誹謗中傷証拠収集ツール (v8.0 \- ユーザー主導型証拠保全)**

### **1\. 開発目標**

未知の攻撃者を発見する「発見モード」と、特定のユーザーを深掘りする「分析モード」を備える。さらに、**ユーザーがGUI上で攻撃性スコアのしきい値を自由に設定**でき、それに基づき選択された投稿の**ウェブ魚拓を一括作成する**、高度にパーソナライズされたプロフェッショナルな証拠収集プラットフォームを構築する。

### **2\. ディレクトリ構造**

（変更なし）

### **3\. AIエージェント向け 高詳細開発指示**

### **【フェーズ0〜2】**

（v7.0計画書と同様）プロジェクトのセットアップ、データ収集モジュールの拡張、高速並列分析エンジンの実装を行う。

### **【フェーズ3】 GUIの刷新と2つのモードの実装**

（v7.0計画書と同様）タブ付きUI、「個別ユーザー分析モード」、「キーワード発見モード」、「モード間連携」、「一括ダウンロード機能」を実装する。

### **【NEW】【フェーズ4】 ユーザー主導型の高度な証拠保全機能**

**目的:** ユーザーが状況に応じて脅威レベルを判断し、選択した証拠を効率的かつ確実に保全できるようにする。

* **タスク 4.1: ユーザープロファイルのスナップショット機能 (modules/scraper.py)**  
  * （v7.0計画書と同様）Scraperクラスにget\_user\_profileメソッドを実装し、分析時にユーザープロファイル情報を取得・保存する。  
* **タスク 4.2: ユーザー主導の一括ウェブ魚拓（アーカイブ）連携機能**  
  * **目的:** ユーザーがGUI上で設定した攻撃性スコアのしきい値に基づき、対象投稿を自動選択し、最終確認後に一括でウェブ魚拓を作成する。  
  * **GUIの変更 (gui/app.py):**  
    1. **スコアしきい値設定スライダーの追加:**  
       * 「個別ユーザー分析モード」の結果表示エリアの上部に、customtkinter.CTkSlider を配置する。範囲は0〜10、初期値は5とする。  
       * スライダーの横に、現在のしきい値を表示するラベルを配置する（例：「自動選択スコア: 5」）。  
    2. **結果表示エリアの変更:**  
       * 各投稿の横にチェックボックスを配置する。  
       * \*\*（改良）\*\*攻撃性スコアに応じて、行の背景色を動的に変更する機能を実装する（例：スコア4-6は黄色、7以上は赤色）。  
    3. **ボタンの配置:**  
       * 結果表示エリアの上部または下部に「選択した投稿の魚拓をまとめて作成」ボタンを配置する。  
  * **機能の実装 (gui/app.py):**  
    1. **動的なチェックマーク更新:** スライダーの値が変更されるたびに、結果リストをループ処理し、表示されている投稿の攻撃性スコアが新しいしきい値以上であれば、対応するチェックボックスをONに、未満であればOFFにする。  
    2. **一括作成の実行:** 「まとめて作成」ボタンがクリックされた際、チェックボックスがONになっている全ての投稿URLのリストを取得し、新しいバックグラウンドスレッドで魚拓作成処理を開始する。（v7.0と同様）  
    3. GUI上では、各投稿のステータス（例：「魚拓作成中...」「完了」）がリアルタイムで更新され、取得した魚拓URLがExcelに追記されるようにする。  
* **【検証ステップ 4】**  
  * 「個別ユーザー分析モード」実行後、結果リストがスコアに応じて色分け表示されることを確認する。  
  * スライダーを動かすと、リアルタイムでチェックマークの状態が更新されることを確認する。  
  * 複数の投稿にチェックを入れ、「まとめて作成」ボタンをクリックする。  
  * GUIがフリーズすることなく、バックグラウンドで処理が進み、ステータスが更新され、最終的に全ての魚拓URLがExcelに記録されることを確認する。

### **【フェーズ5】 最終化とドキュメント整備**

* **タスク 5.1 \- 5.2:** （v7.0計画書と同様）コードのクリーンアップ、型ヒントの追加、そして新しい証拠保全機能を含む全機能の使い方を網羅した高品質なREADME.mdを作成する。  
* **【検証ステップ 5】**  
  * README.md の指示のみで、全ての機能が問題なく利用できることを最終確認する。

### **AIエージェント進捗ログ (AI Agent Progress Log)**

*AIエージェントは、各タスク完了後にこのリストを更新すること。*

* [x] **Phase 0**
* [x] **Phase 1**
* [x] **Phase 2**
* [x] **Phase 3**
* [x] **Phase 4**
  * [x] Task 4.1: ユーザープロファイルのスナップショット機能
  * [x] Task 4.2: ユーザー主導の一括ウェブ魚拓（アーカイブ）連携機能
  * [x] Verification 4
* [x] **Phase 5**
* [x] 2025-07-11 現行の実装がAGENT3.mdと一致することを確認

### **補足: PR作成エラーへの対処**

プルリクエスト作成時に"Failed to create PR"と表示されることがある。`__pycache__`
や `.pytest_cache` などのキャッシュが原因となるため、以下を実施する。

1. `git status --short` で不要ファイルを確認。
2. `.gitignore` へキャッシュディレクトリを追加し、既存のキャッシュは `git clean -fd`
   で削除する。
3. 改めてコミットしてPRを作成する。
